<!DOCTYPE html>
<html lang="en">

<head>
	<title>Shoping Cart</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="/kiona-logo.png" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/fonts/linearicons-v1.0.0/icon-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/vendor/perfect-scrollbar/perfect-scrollbar.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/css/util.css">
	<link rel="stylesheet" type="text/css" href="/css/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7Yk4nWXwLMUAmxZf3oL8f1cP9J4nHuir0N2bCJ6RJrxCYp7oI7fp2Lm" crossorigin="anonymous">
	<!--===============================================================================================-->
</head>

<body class="animsition">

	<!-- Header -->
	<header class="header-v4">
		<!-- Header desktop -->
		<div class="container-menu-desktop">
			<!-- Topbar -->
			<div class="top-bar">
				<div class="content-topbar flex-sb-m h-full container">
					<div class="left-top-bar">
						KIONA
					</div>

					<div class="right-top-bar flex-w h-full">
						<a href="#" class="flex-c-m trans-04 p-lr-25">
							Help & FAQs
						</a>

						<a href="/" class="flex-c-m trans-04 p-lr-25">
							Home
						</a>

						<% if(user){%>

                            <a href="/userProfile" class="flex-c-m trans-04 p-lr-25">
                                My Account
                            </a>

                            <a href="/logout" class="flex-c-m trans-04 p-lr-25">
                                Logout
                            </a>

                            

                        <%}else{%>
                            <a href="/login" class="flex-c-m trans-04 p-lr-25">
                                Login
                            </a>
                            <a href="/register" class="flex-c-m trans-04 p-lr-25">
                                Sign Up
                            </a>
                       <% } %>

						
					</div>
				</div>
			</div>

	<!-- breadcrumb -->
	<div class="container">
		<div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
			<a href="/" class="stext-109 cl8 hov-cl1 trans-04">
				Home
				<i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
			</a>

			<a href="/shoping-cart" class="stext-109 cl8 hov-cl1 trans-04">
				Shoping Cart
				<i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
			</a>

            <span class="stext-109 cl4">
				Select Address
			</span>

		</div>
	</div>


	<!-- Shoping Cart -->
	<div class="bg0 p-t-30 p-b-85">
		<div class="container">
			<div class="row">
				<div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
					<div class="m-l-25 m-r--38 m-lr-0-xl">
						<div class="wrap-table-shopping-cart">
							<div class="container">
								<a href="/shoping-cart/selectAddress/addAddress">
									<div class="flex-c-m stext-101 cl2 size-119 btn-success bor13 p-lr-15 trans-04 pointer m-tb-10">
										<button style="color: aliceblue;" >Add Address</button>
									</div>
								</a>
								<% if (addressData.addresses && addressData.addresses.length > 0) { %>
									<% for (let i = 0; i < addressData.addresses.length; i++) { %>
										<div class="card-body">
											<h5 class="card-title">
												<p class="card-text">
													<input type="radio" name="addresses" value="<%= addressData.addresses[i]._id %>" onchange="selectAddress()">
													<span style="margin-right: 15px; font-weight: bold;"> <%= addressData.addresses[i].name %> </span>
													<span class="address-type-style" style="  border: 1px solid #ddd; padding: 2px 5px; border-radius: 4px; display: inline-block; background-color: antiquewhite; " > <%= addressData.addresses[i].addressType %> </span>
													<span style="font-weight: bold; margin-left: 15px"> <%= addressData.addresses[i].mobile %> </span>
												</p>
											</h5>
											<p>
												<%= addressData.addresses[i].address %>,
												<%= addressData.addresses[i].locality %>,
												<%= addressData.addresses[i].city %>,
												<p>
													<%= addressData.addresses[i].state %> -
													<%= addressData.addresses[i].pincode %>
												</p>
												
											</p>
											<p class="mt-3"></p>
											<button type="button" class="btn btn-info" onclick="editAddress('<%= addressData.addresses[i]._id %>')">Edit</button>
											<button type="button" class="btn btn-danger" onclick="deleteAddress('<%= addressData.addresses[i]._id %>')">Delete</button>
										</div>
										<hr>
									<% } %>
								<% } else { %>
									<p style="text-align: center; margin-top: 20px;">No address available.</p>
								<% } %>
							</div>
						</div>
					</div>
				</div>
	
				<div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
					<div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
						<h4 class="mtext-109 cl2 p-b-30">
							Cart Totals
						</h4>
						<div class="flex-w flex-t bor12 p-b-13">
							<div class="size-208">
								<span class="stext-110 cl2">
									Subtotal:
								</span>
							</div>
							<div class="size-209">
								<span class="mtext-110 cl2" id="totalAmount">
									$
								</span>
							</div>
						</div>
						<div class="flex-w flex-t bor12 p-t-15 p-b-30">
							<div class="size-208 w-full-ssm">
								<span class="stext-110 cl2">
									Shipping:
								</span>
							</div>
							<div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
								<p class="stext-111 cl6 p-t-2">
									There are no shipping methods available. Please double check your address, or contact us if you need any help.
								</p>
								<div class="p-t-15">
									<span class="stext-112 cl8">
										Calculate Shipping
									</span>
								</div>
							</div>
						</div>
						<div class="flex-w flex-t p-t-27 p-b-33">
							<div class="size-208">
								<span class="mtext-101 cl2">
									Total:
								</span>
							</div>
							<div class="size-209 p-t-1">
								<span class="mtext-110 cl2" id="totalAmount">
									$
								</span>
							</div>
						</div>
						<a href="/shoping-cart/checkout_summary">
							<button class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
								Delivery Here
							</button>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<%- include('../../layouts/footer.ejs') %>

	

	<!-- Back to top -->
	<div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
	</div>

	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<!--===============================================================================================-->
	<script src="/vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function () {
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
	<!--===============================================================================================-->
	<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
	<!--===============================================================================================-->
	<script src="/assets/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function () {
			$(this).css('position', 'relative');
			$(this).css('overflow', 'hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function () {
				ps.update();
			})
		});
	</script>
	<!--===============================================================================================-->
	<script src="/js/main.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQ2t8wPd4NzzBqxREyZK8XvCqaEiPTzUMHPO+sB4QQyebJgZDedQ1IKfHAj62N2F" crossorigin="anonymous"></script>

	<script>

		async function editAddress(addressId){
			window.location.href = `/shoping-cart/selectAddress/editAddress?id=${addressId}`
		}

		async function deleteAddress(id) {
			const confirmation = await Swal.fire({
				title: 'Are you sure?',
				text: 'You won\'t be able to revert this!',
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, delete it!'
			});

			if (confirmation.isConfirmed) {
				try {
					const response = await axios.delete('/shoping-cart/selectAddress/delete', { data: { id } });
					if (response.data.success) {
						await Swal.fire({
							icon: 'success',
							title: 'Deleted!',
							text: response.data.message
						}).then(() => {
							window.location.href = '/shoping-cart/selectAddress';
						});
					} else {
						await Swal.fire({
							icon: 'error',
							title: 'Error',
							text: response.data.message
						});
						window.location.href = '/shoping-cart/selectAddress';
					}
				} catch (error) {
					console.error("Error deleting address: ", error.message);
					Swal.fire({
						icon: 'error',
						title: 'Error',
						text: 'There was an error deleting the address'
					});
				}
			}
		}


	</script>

		

</body>

</html>