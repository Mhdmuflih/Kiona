<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kiona</title>

	<!-- icon of my page -->
	<link rel="icon" type="image/png" href="/kiona-logo.png" />

	<!-- this is navbar style -->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">

	<!-- this is over all page style -->
	<link rel="stylesheet" type="text/css" href="/css/userProfile.css">
	<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css'>

	<!-- this is password icon  -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">



</head>

<body>


	<div class="top-bar">
		<div class="content-topbar flex-sb-m h-full container">
			<div class="left-top-bar">
				Free shipping for standard order over $100
			</div>

			<div class="right-top-bar flex-w h-full">
				<a href="#" class="flex-c-m trans-04 p-lr-25">
					Help & FAQs
				</a>




				<% if(user){%>
					
					<a href="/" class="flex-c-m trans-04 p-lr-25">
						Home
					</a>

					<a href="/userProfile" class="flex-c-m trans-04 p-lr-25">
						My Account
					</a>

					<a href="/logout" class="flex-c-m trans-04 p-lr-25">
						Logout
					</a>



					<%}else{%>
						<a href="/login" class="flex-c-m trans-04 p-lr-25">
							Login
						</a>
						<a href="/register" class="flex-c-m trans-04 p-lr-25">
							Sign Up
						</a>
						<% } %>

			</div>
		</div>
	</div>

	<div>
		<p></p>
	</div>
	<div>
		<p></p>
	</div>



	<div class="container">
		<div class="main-body">
			<div class="row">
				<div class="col-lg-4">
					<div class="card">
						<div class="card-body">
							<div class="d-flex flex-column align-items-center text-center">
								<img src="/Photos/userImages/<%= user.image %>" alt="Admin"
									class="rounded-circle p-1 bg-primary" width="110">
								<div class="mt-3">
									<h4>
										<%= user.name %>
									</h4>
									<!-- <p class="text-secondary mb-1"></p>
									<p class="text-muted font-size-sm"></p>
									<button class="btn btn-primary">Follow</button>
									<button class="btn btn-outline-primary">Message</button> -->
								</div>
							</div>
							<hr class="my-4">
							<ul class="list-group list-group-flush">
								<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
									style="width: 310px;">
									<a href="/userProfile"> <button type="button" class="btn btn-outline-info"
											style="width: 280px;">User Profile</button> </a>
								</li>
								<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
									style="width: 310px;">
									<a href="/changePassword"> <button type="button" class="btn btn-info"
											style="width: 280px;">Change Password</button> </a>
								</li>
								<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
									style="width: 310px;">
									<a href="/address"> <button type="button" class="btn btn-outline-info"
											style="width: 280px;">Address Management</button> </a>
								</li>
								<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
									style="width: 310px;">
									<a href="/order"> <button type="button" class="btn btn-outline-info"
											style="width: 280px;">Order</button> </a>
								</li>

							</ul>
						</div>
					</div>
				</div>

				<div class="col-lg-8">
					<div class="card">
						<form action="/changePassword" class="form" method="post" onsubmit="check(); return false">
							<div class="card-body">
								<div class="row mb-3">
									<div class="col-sm-3">
										<h6 class="mb-0">Current Password</h6>
									</div>
									<div class="col-sm-9 text-secondary">
										<input type="password" name="password" id="password" class="form-control"
											type="text" placeholder="Enter password" required="" aria-required="true">

										<button class="btn toggle-password"
											style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);"><i
												class="fa fa-eye-slash" aria-hidden="true"></i>
										</button>
										<p style="color: red;" id="passErr"></p>

									</div>
								</div>
								<div class="row mb-3">
									<div class="col-sm-3">
										<h6 class="mb-0">New Password</h6>
									</div>
									<div class="col-sm-9 text-secondary">
										<input type="password" name="password1" id="password1" class="form-control"
											type="text" placeholder="Enter New Password" required=""
											aria-required="true">

										<button class="btn toggle-password"
											style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">
											<i class="fa fa-eye-slash" aria-hidden="true"></i>
										</button>
										<p style="color: red;" id="pass1Err"></p>

									</div>
								</div>
								<div class="row mb-3">
									<div class="col-sm-3">
										<h6 class="mb-0">Conform Password</h6>
									</div>
									<div class="col-sm-9 text-secondary">
										<input type="password" name="password2" id="password2" class="form-control"
											type="text" placeholder="Enter Conofrm Password" required=""
											aria-required="true">

										<button class="btn toggle-password"
											style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">
											<i class="fa fa-eye-slash" aria-hidden="true"></i>
										</button>
										<p style="color: red;" id="pass2Err"></p>

									</div>
								</div>


								<div class="form-group">
									<input type="hidden" name="id" value="<%= user._id %>">
								</div>

								<% if(message){%>
									<p class="text-danger" id="ok">
									  <%= message %>
									</p>
								<% } %>

								<p></p>
								<div class="row">
									<div class="col-sm-3"></div>
									<div class="col-sm-9 text-secondary">
										<input type="submit" class="btn btn-primary px-4" value="Save Changes">
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- this is page cdn -->
	<script src='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js'></script>

	<!-- icon function -->
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const togglePasswordButtons = document.querySelectorAll('.toggle-password');

			togglePasswordButtons.forEach(button => {
				button.addEventListener('click', function (e) {
					e.preventDefault();
					const passwordInput = this.previousElementSibling; // Assuming the button is right after the input field
					const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
					passwordInput.setAttribute('type', type);
					this.innerHTML = type === 'password' ? '<i class="fa fa-eye-slash" aria-hidden="true"></i>' : '<i class="fa fa-eye" aria-hidden="true"></i>';
				});
			});
		});
	</script>

	<!-- form validation -->

	<script>
		function check() {
			// Grab form elements and clear any previous messages
			const form = document.querySelector('form');
			const password = document.getElementById('password').value.trim();
			const passErr = document.getElementById('passErr');
			const password1 = document.getElementById('password1').value.trim();
			const pass1Err = document.getElementById('pass1Err'); // Correct ID references
			const password2 = document.getElementById('password2').value.trim();
			const pass2Err = document.getElementById('pass2Err'); // Correct ID references
		
		
			const passErrMsg = [];
			const pass1ErrMsg = [];
			const pass2ErrMsg = [];

			console.log(password)
		
			// Validation for current password ntte
			if (password === '') {
				passErrMsg.push('Please enter your current password.');
			} else {
				const passwordRegex = [
					{ regex: /.{8,}/, message: "At least 8 characters" },
					{ regex: /\d/, message: "At least 1 digit" },
					{ regex: /[a-z]/, message: "At least 1 lowercase letter" },
					{ regex: /[A-Z]/, message: "At least 1 uppercase letter" },
					{ regex: /[!@#$%^&*]/, message: "At least 1 special character" }
				];
		
				passwordRegex.forEach((rule) => {
					if (!rule.regex.test(password)) {
						passErrMsg.push(rule.message);
					}
				});
			}
		
			// Validation for new password ntte
			if (password1 === '') {
				pass1ErrMsg.push('Please enter your new password.');
			} else {
				const passwordRegex = [
					{ regex: /.{8,}/, message: "At least 8 characters" },
					{ regex: /\d/, message: "At least 1 digit" },
					{ regex: /[a-z]/, message: "At least 1 lowercase letter" },
					{ regex: /[A-Z]/, message: "At least 1 uppercase letter" },
					{ regex: /[!@#$%^&*]/, message: "At least 1 special character" }
				];

				passwordRegex.forEach((rule) => {
					if (!rule.regex.test(password1)) {
						pass1ErrMsg.push(rule.message);
					}
				});
			}
		
			// Validation for confirm password ntte
			if (password2 === '') {
				pass2ErrMsg.push('Please enter your confirm password.');
			} else {
				const passwordRegex = [
					{ regex: /.{8,}/, message: "At least 8 characters" },
					{ regex: /\d/, message: "At least 1 digit" },
					{ regex: /[a-z]/, message: "At least 1 lowercase letter" },
					{ regex: /[A-Z]/, message: "At least 1 uppercase letter" },
					{ regex: /[!@#$%^&*]/, message: "At least 1 special character" }
				];

				passwordRegex.forEach((rule) => {
					if (!rule.regex.test(password2)) {
						pass2ErrMsg.push(rule.message);
					}
				});
			}
		
			if (password1 !== password2) {
				pass2ErrMsg.push('Confirm password does not match new password.');
			}
		
			// Display error messages
			passErr.innerHTML = passErrMsg.join("<br>");
			pass1Err.innerHTML = pass1ErrMsg.join("<br>");
			pass2Err.innerHTML = pass2ErrMsg.join("<br>");
			
			
			if( passErrMsg.length === 0 && pass1ErrMsg.length === 0 && pass2ErrMsg.length === 0 ){
				form.submit();
			}
		}
		</script>
		

</body>

</html>