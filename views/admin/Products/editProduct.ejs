<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from demo.bootstrapdash.com/purple-admin-free/pages/forms/basic_elements.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 28 Dec 2023 06:57:48 GMT -->

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Purple Admin</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="../../admin/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../admin/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="../../admin/css/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="../../admin/images/kiona-logo.png" />
</head>

<body>
    <div class="container-scroller">
        <!-- partial:../../partials/_navbar.html -->
        <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
            <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
                <a class="navbar-brand brand-logo" href="/admin/home"><img class="h-50"
                        src="/kiona-high-resolution-logo-transparent.png" alt="logo" /></a>
            </div>
            <div class="navbar-menu-wrapper d-flex align-items-stretch">
                <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
                    <span class="mdi mdi-menu"></span>
                </button>
                <div class="search-field d-none d-md-block">
                    <form class="d-flex align-items-center h-100" action="#">
                        <div class="input-group">
                            <div class="input-group-prepend bg-transparent">
                                <i class="input-group-text border-0 mdi mdi-magnify"></i>
                            </div>
                            <input type="text" class="form-control bg-transparent border-0"
                                placeholder="Search projects">
                        </div>
                    </form>
                </div>
                <ul class="navbar-nav navbar-nav-right">


                    <li class="nav-item nav-logout d-none d-lg-block">
                        <a class="nav-link" href="/admin/logout">
                            <i class="mdi mdi-power"></i>
                        </a>
                    </li>

                </ul>
                <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
                    data-toggle="offcanvas">
                    <span class="mdi mdi-menu"></span>
                </button>
            </div>
        </nav>
        <!-- partial -->
        <div class="container-fluid page-body-wrapper">
            <!-- partial:../../partials/_sidebar.html -->
            <nav class="sidebar sidebar-offcanvas" id="sidebar">
                <ul class="nav">
                    <li class="mt-4">
                        <a class="nav-link" href="/admin/home">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100">Dashboard <i class="mdi mdi-home menu-icon"></i>
                          </button>
                        </a>
                      </li>
                      <li >
                        <a class="nav-link" href="/admin/users">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100">User <i class="mdi mdi-contacts menu-icon"></i>
                          </button>
                        </a>
                      </li>
                     
                      <li>
                        <a class="nav-link" href="/admin/product">
                          <button type="button" class="btn btn-gradient-dark btn-rounded w-100">Products <i class="mdi mdi-tshirt-crew "></i> </button>
                        </a>
                      </li>
                      <li>
                        <a class="nav-link" href="/admin/category">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100 ">Category <i class="mdi mdi-cards"></i> </button>
                        </a>
                      </li>
                      <li>
                        <a class="nav-link" href="/admin/order">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100 ">Order <i class="mdi mdi-shopping"></i> </button>
                        </a>
                      </li>
                      <li >
                        <a class="nav-link" data-toggle="collapse" href="#general-pages" aria-expanded="false" aria-controls="general-pages">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100 ">Offer <i class="mdi mdi-percent"></i> </button>
                          <i class="menu-arrow"></i>
                        </a>
                        <div class="collapse" id="general-pages">
                          <ul class="nav flex-column sub-menu">
                            <li class="nav-item"> <a class="nav-link" href="/admin/categoryOffers"> Category Offers </a></li>
                            <li class="nav-item"> <a class="nav-link" href="/admin/productOffers"> Product Offers </a></li>
                            <!-- <li class="nav-item"> <a class="nav-link" href="pages/samples/register.html"> Register </a></li>
                            <li class="nav-item"> <a class="nav-link" href="pages/samples/error-404.html"> 404 </a></li>
                            <li class="nav-item"> <a class="nav-link" href="pages/samples/error-500.html"> 500 </a></li> -->
                          </ul>
                        </div>
                      </li>
                      <li>
                        <a class="nav-link" href="/admin/couponOffers">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100 "> Coupons <i class="mdi mdi-ticket"></i> </button>
                        </a>
                      </li>
                      <li>
                        <a class="nav-link" href="/admin/salesReport">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100 ">Sales <i class="mdi mdi-sale"></i> </button>
                        </a>
                      </li>
                      <li>
                        <a class="nav-link" href="pages/tables/basic-table.html">
                          <button type="button" class="btn btn-inverse-dark btn-rounded w-100 ">Banner <i class="mdi mdi-clipboard-outline"></i> </button>
                        </a>
                      </li>
                </ul>
            </nav>
            <!-- partial -->
            <div class="main-panel">
                <div class="content-wrapper">
                    <div class="page-header">
                        <h3 class="page-title"> Edit Product </h3>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/admin/editProduct?id=<%= product._id %> ">Edit
                                        Product</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Products</li>
                            </ol>
                        </nav>
                    </div>

                    <div class="row">


                        <div class="col-12 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Edit Product</h4>
                                    <p class="card-description"> </p>

                                    <form method="post" id="form" class="forms-sample" enctype="multipart/form-data">
                                        <div class="form-group">
                                            <label>Product upload</label>
                                            <input type="file" value="<%= product.image %>" name="images" class="file-upload-default" multiple>
                                            <div class="input-group col-xs-12">
                                                <input type="text" class="form-control file-upload-info" disabled placeholder="Upload Image">
                                                <span class="input-group-append">
                                                    <button class="file-upload-browse btn btn-gradient-primary" type="button">Upload</button>
                                                </span>
                                            </div>
                                        </div>
                                        <!-- <p style="color: red;" id="imageErr"></p> -->

                                    
                                        <div class="form-group">
                                            <label>Uploaded Images</label>
                                            <div class="image-container">
                                                <% product.image.forEach(function(image) { %>
                                                <div class="image-item" style="position: relative; display: inline-block;">
                                                    <img src="/Photos/product/<%= image %>" alt="Product Image" class="img-fluid"
                                                        style="max-width: 200px; max-height: 200px; margin-right: 10px;">
                                                    <button type="button" class="close-button"
                                                        style="position: absolute; top: 5px; margin-right: 5px; right: 10px; background:red; border: none; outline: none; color: white;" onclick="deleteImage('<%= image %>')">
                                                        X
                                                    </button>
                                                </div>
                                                <% }); %>
                                            </div>
                                        </div>
                                        <!-- <p style="color: red;" id="imageErr"></p> -->
                                    
                                        <div class="form-group">
                                            <label for="name">Name</label>
                                            <input type="text" value="<%= product.name %>" name="name" class="form-control" id="name" placeholder="Name">
                                        </div>
                                        <p style="color: red;" id="nameErr"></p>
                                        <div class="form-group">
                                            <label for="price">Price</label>
                                            <input type="text" value="<%= product.price %>" name="price" id="price" class="form-control" placeholder="Price">
                                        </div>
                                        <p style="color: red;" id="priceErr"></p>
                                        <div class="form-group">
                                            <label for="quantity">Quantity</label>
                                            <input type="text" value="<%= product.quantity %>" name="quantity" id="quantity" class="form-control" placeholder="Quantity">
                                        </div>
                                        <p style="color: red;" id="quantityErr"></p>
                                        <div class="form-group">
                                            <label for="category">Categories</label>
                                            <select class="form-control my-custom-dropdown" name="category" id="category">
                                                <!-- <option value="">Select Category</option> -->
                                                <% for(let i=0 ; i<category.length ; i++){ %>
                                                  <% if(category[i].delete === false){ %>
                                                    <option> <%= category[i].name %> </option>
                                                  <% } %>
                                                <% } %>
                                              </select>
                                        </div>
                                        <p style="color: red;" id="categoryErr"></p>
                                        <div class="form-group">
                                            <input type="hidden" name="product_id" id="productId" value="<%= product._id %>">
                                        </div>
                                    
                                        <div class="form-group">
                                            <input type="hidden" name="category_id" value="<%= category._id %>">
                                        </div>
                                    
                                        <div class="form-group">
                                            <label for="description">Description</label>
                                            <textarea class="form-control" name="description" id="description" rows="4" required><%= product.description %></textarea>
                                        </div>
                                        <p style="color: red;" id="descriptionErr"></p>
                                    
                                        <button type="submit" class="btn btn-gradient-primary mr-2">Submit</button>
                                        <button class="btn btn-light">Cancel</button>
                                    </form>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <% if(typeof message !=='undefined' ){ %>
        <p>
            <%= message %>
        </p>
        <% } %>

            </div>
            <!-- content-wrapper ends -->
            <!-- partial:../../partials/_footer.html -->
            <footer class="footer">
                <div class="container-fluid clearfix">
                    <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">kiona Â©
                        kiona.com 2020</span>
                    <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"> <a
                            href="https://www.bootstrapdash.com/bootstrap-admin-template/" target="_blank">kiona
                            admin</a> from kiona.com</span>
                </div>
            </footer>
            <!-- partial -->
            </div>
            <!-- main-panel ends -->
            </div>
            <!-- page-body-wrapper ends -->
            </div>
            <!-- container-scroller -->
            <!-- plugins:js -->
            <script src="../../admin/vendors/js/vendor.bundle.base.js"></script>
            <!-- endinject -->
            <!-- Plugin js for this page -->
            <!-- End plugin js for this page -->
            <!-- inject:js -->
            <script src="../../admin/js/off-canvas.js"></script>
            <script src="../../admin/js/hoverable-collapse.js"></script>
            <script src="../../admin/js/misc.js"></script>
            <!-- endinject -->
            <!-- Custom js for this page -->
            <script src="../../admin/js/file-upload.js"></script>
            <!-- End custom js for this page -->



            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


            <script>

async function deleteImage(imageId) {
    console.log(imageId);

    const confirmation = await Swal.fire({
        title: 'Are you sure?',
        text: 'You won\'t be able to revert this!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, Update Product!'
    });

    if (confirmation.isConfirmed) {
        try {
            const productId = document.getElementById('productId').value;

            const response = await axios.delete(`/admin/editProduct/deleteImage?id=${productId}&imageId=${imageId}`);

            if (response.data.success) {
                await Swal.fire({
                    icon: 'success',
                    title: 'Update Product!',
                    text: response.data.message
                });
                window.location.href = `/admin/editProduct?id=${productId}`;
            } else {
                await Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: response.data.message
                });
                window.location.href = `/admin/editProduct?id=${productId}`;
            }
        } catch (error) {
            console.error("Error updating Product: ", error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'There was an error updating the Product'
            });
        }
    }
}


                // document.addEventListener("DOMContentLoaded", function () {
                //     var cancelClicked = false;

                //     var closeButtons = document.querySelectorAll('.close-button');
                //     closeButtons.forEach(function (button) {
                //         button.addEventListener('click', function () {
                //             if (!cancelClicked) {
                //                 var imageItem = button.closest('.image-item');
                //                 imageItem.remove();
                //             }
                //         });
                //     });

                //     // Add event listener to cancel button
                //     var cancelButton = document.querySelector('.btn-light');
                //     cancelButton.addEventListener('click', function () {
                //         cancelClicked = true; // Set flag to true when cancel button is clicked
                //     });
                // });

                document.getElementById("form").addEventListener("submit", async (e) => {
                    e.preventDefault();
                    check();
                })
                const check = async () => {
    // const imageInput = document.getElementById("image");
    // const imageErr = document.getElementById("imageErr");
    const name = document.getElementById("name").value.trim();
    const nameErr = document.getElementById("nameErr");
    const price = document.getElementById("price").value.trim();
    const priceErr = document.getElementById("priceErr");
    const quantity = document.getElementById("quantity").value.trim();
    const quantityErr = document.getElementById("quantityErr");
    const category = document.getElementById('category').value.trim();
    const categoryErr = document.getElementById('categoryErr');
    const description = document.getElementById("description").value.trim();
    const descriptionErr = document.getElementById("descriptionErr");

    
    let isValid = true;

    // imageErr.innerHTML = '';
    nameErr.innerHTML = '';
    priceErr.innerHTML = '';
    quantityErr.innerHTML = '';
    categoryErr.innerHTML = '';
    descriptionErr.innerHTML = '';

    // if (!imageInput.files || imageInput.files.length === 0) {
    //     imageErr.innerHTML = "Please select an Image";
    //     isValid = false;
    // } else {
    //     for (let i = 0; i < imageInput.files.length; i++) {
    //         const image = imageInput.files[i];
    //         if (!/\.(jpg|jpeg|png)$/i.test(image.name)) {
    //             imageErr.innerHTML = "Only JPG, JPEG, or PNG files are allowed.";
    //             isValid = false;
    //             break;
    //         }
    //         if (image.size > 5242880) { // 5 * 1024 * 1024
    //             imageErr.innerHTML += "<br>File size must not exceed 5MB.";
    //             isValid = false;
    //             break;
    //         }
    //     }
    // }

    if (!name) {
        nameErr.innerHTML = "Please Enter the Name.";
        isValid = false;
    }

    const priceRegex = /^\d+(\.\d{1,2})?$/;
    if (!price) {
        priceErr.innerHTML = "Please Enter Price";
        isValid = false;
    } else if (!priceRegex.test(price)) {
        priceErr.innerHTML = "Price must be a positive number with up to 2 decimal places";
        isValid = false;
    }

    const quantityRegex = /^\d+(\.\d{1,2})?$/;
    if (!quantity) {
        quantityErr.innerHTML = "Please Enter Quantity";
        isValid = false;
    } else if (!quantityRegex.test(quantity)) {
        quantityErr.innerHTML = "Quantity must be a positive number with up to 2 decimal places";
        isValid = false;
    }

    if (!category) {
        categoryErr.innerHTML = "Please select a category";
        isValid = false;
    }

    if (!description) {
        descriptionErr.innerHTML = "Please Enter Description.";
        isValid = false;
    }

    if (isValid) {
        const confirmation = await Swal.fire({
            title: 'Are you sure?',
            text: 'You won\'t be able to revert this!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, Update Product!'
        });

        if (!confirmation.isConfirmed) {
            return;
        }

        const formElement = document.getElementById("form");
        const formData = new FormData(formElement);
        const productId = formData.get("product_id");

        try {
            const response = await axios.post(`/admin/editProduct?id=${productId}`, formData);

            if (response.data.success) {
                await Swal.fire({
                    icon: 'success',
                    title: 'Update Product!',
                    text: response.data.message
                });
                window.location.href = `/admin/product`;
            } else {
                await Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: response.data.message
                });
                window.location.href = `/admin/editProduct?id=${productId}`;
            }
        } catch (error) {
            console.error("Error updating Product: ", error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'There was an error updating the Product'
            });
        }
    }
};


                                
            </script>






</body>

<!-- Mirrored from demo.bootstrapdash.com/purple-admin-free/pages/forms/basic_elements.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 28 Dec 2023 06:57:48 GMT -->

</html>